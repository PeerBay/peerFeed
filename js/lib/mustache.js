(function(m,n){"object"===typeof exports&&exports?n(exports):"function"===typeof define&&define.amd?define(["exports"],n):n(m.Mustache={})})(this,function(m){function n(a){return"function"===typeof a}function w(a){return a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function A(a,c){function b(a){"string"===typeof a&&(a=a.split(B,2));if(!x(a)||2!==a.length)throw Error("Invalid tags: "+a);f=new RegExp(w(a[0])+"\\s*");t=new RegExp("\\s*"+w(a[1]));p=new RegExp("\\s*"+w("}"+a[1]))}if(!a)return[];var d=
[],g=[],e=[],n=!1,l=!1,f,t,p;b(c||m.tags);for(var k=new v(a),q,h,r,u;!k.eos();){q=k.pos;if(r=k.scanUntil(f)){u=0;for(var s=r.length;u<s;++u)if(h=r.charAt(u),C.call(D,h)?l=!0:e.push(g.length),g.push(["text",h,q,q+1]),q+=1,"\n"===h){if(n&&!l)for(;e.length;)delete g[e.pop()];else e=[];l=n=!1}}if(!k.scan(f))break;n=!0;h=k.scan(E)||"name";k.scan(F);"="===h?(r=k.scanUntil(z),k.scan(z),k.scanUntil(t)):"{"===h?(r=k.scanUntil(p),k.scan(G),k.scanUntil(t),h="&"):r=k.scanUntil(t);if(!k.scan(t))throw Error("Unclosed tag at "+
k.pos);u=[h,r,q,k.pos];g.push(u);if("#"===h||"^"===h)d.push(u);else if("/"===h){h=d.pop();if(!h)throw Error('Unopened section "'+r+'" at '+q);if(h[1]!==r)throw Error('Unclosed section "'+h[1]+'" at '+q);}else"name"===h||"{"===h||"&"===h?l=!0:"="===h&&b(r)}if(h=d.pop())throw Error('Unclosed section "'+h[1]+'" at '+k.pos);return H(I(g))}function I(a){for(var c=[],b,d,g=0,e=a.length;g<e;++g)if(b=a[g])"text"===b[0]&&d&&"text"===d[0]?(d[1]+=b[1],d[3]=b[3]):(c.push(b),d=b);return c}function H(a){for(var c=
[],b=c,d=[],g,e=0,m=a.length;e<m;++e)switch(g=a[e],g[0]){case "#":case "^":b.push(g);d.push(g);b=g[4]=[];break;case "/":b=d.pop();b[5]=g[2];b=0<d.length?d[d.length-1][4]:c;break;default:b.push(g)}return c}function v(a){this.tail=this.string=a;this.pos=0}function p(a,c){this.view=null==a?{}:a;this.cache={".":this.view};this.parent=c}function s(){this.cache={}}var J=Object.prototype.toString,x=Array.isArray||function(a){return"[object Array]"===J.call(a)},C=RegExp.prototype.test,D=/\S/,K={"&":"&amp;",
"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},F=/\s*/,B=/\s+/,z=/\s*=/,G=/\s*\}/,E=/#|\^|\/|>|\{|&|=|!/;v.prototype.eos=function(){return""===this.tail};v.prototype.scan=function(a){a=this.tail.match(a);if(!a||0!==a.index)return"";a=a[0];this.tail=this.tail.substring(a.length);this.pos+=a.length;return a};v.prototype.scanUntil=function(a){a=this.tail.search(a);var c;switch(a){case -1:c=this.tail;this.tail="";break;case 0:c="";break;default:c=this.tail.substring(0,a),this.tail=this.tail.substring(a)}this.pos+=
c.length;return c};p.prototype.push=function(a){return new p(a,this)};p.prototype.lookup=function(a){var c=this.cache,b;if(a in c)b=c[a];else{for(var d=this,g,e;d;){if(0<a.indexOf("."))for(b=d.view,g=a.split("."),e=0;null!=b&&e<g.length;)b=b[g[e++]];else b=d.view[a];if(null!=b)break;d=d.parent}c[a]=b}n(b)&&(b=b.call(this.view));return b};s.prototype.clearCache=function(){this.cache={}};s.prototype.parse=function(a,c){var b=this.cache,d=b[a];null==d&&(d=b[a]=A(a,c));return d};s.prototype.render=function(a,
c,b){var d=this.parse(a);c=c instanceof p?c:new p(c);return this.renderTokens(d,c,b,a)};s.prototype.renderTokens=function(a,c,b,d){function g(a){return p.render(a,c,b)}for(var e="",p=this,l,f,t=0,s=a.length;t<s;++t)switch(l=a[t],l[0]){case "#":f=c.lookup(l[1]);if(!f)continue;if(x(f))for(var k=0,q=f.length;k<q;++k)e+=this.renderTokens(l[4],c.push(f[k]),b,d);else if("object"===typeof f||"string"===typeof f)e+=this.renderTokens(l[4],c.push(f),b,d);else if(n(f)){if("string"!==typeof d)throw Error("Cannot use higher-order sections without the original template");
f=f.call(c.view,d.slice(l[3],l[5]),g);null!=f&&(e+=f)}else e+=this.renderTokens(l[4],c,b,d);break;case "^":f=c.lookup(l[1]);if(!f||x(f)&&0===f.length)e+=this.renderTokens(l[4],c,b,d);break;case ">":if(!b)continue;f=n(b)?b(l[1]):b[l[1]];null!=f&&(e+=this.renderTokens(this.parse(f),c,b,f));break;case "&":f=c.lookup(l[1]);null!=f&&(e+=f);break;case "name":f=c.lookup(l[1]);null!=f&&(e+=m.escape(f));break;case "text":e+=l[1]}return e};m.name="mustache.js";m.version="0.8.1";m.tags=["{{","}}"];var y=new s;
m.clearCache=function(){return y.clearCache()};m.parse=function(a,c){return y.parse(a,c)};m.render=function(a,c,b){return y.render(a,c,b)};m.to_html=function(a,c,b,d){a=m.render(a,c,b);if(n(d))d(a);else return a};m.escape=function(a){return String(a).replace(/[&<>"'\/]/g,function(a){return K[a]})};m.Scanner=v;m.Context=p;m.Writer=s});